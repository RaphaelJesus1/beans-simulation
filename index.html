<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="shortcut icon" type="image/x-icon" href="Images/logoEscuroSemFundo.png"> -->
    <link rel="stylesheet" href="./src/style.css">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <title>beans</title>
    
    <!-- A ordem de importar o script deve ser do que não depende de nada até os que dependem... (pra n bugar)-->
    <script type="text/javascript" src="./src/models/Vector.js"></script>
    <script type="text/javascript" src="./src/models/Circle.js"></script>
    <script type="text/javascript" src="./src/models/Point.js"></script>
    <script type="text/javascript" src="./src/models/Rectangle.js"></script>
    <script type="text/javascript" src="./src/models/QuadTree.js"></script>
    <script type="text/javascript" src="./src/models/DNA.js"></script>
    <script type="text/javascript" src="./src/models/Vegetable.js"></script>
    <script type="text/javascript" src="./src/models/Organism.js"></script>
    <script type="text/javascript" src="./src/models/Info.js"></script>
    <script type="text/javascript" src="./src/models/History.js"></script>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet" />
   <style>
        body{
            margin: 0
        }
    </style>
    <script type="text/javascript">
        var hora = minuto = segundo = milisegundo = 0;
        var segundos_totais = 0;
    </script>
</head>

<body style="background: #222">
    <!-- <div class="splash" style="background: #333;">
        <div class="d-flex flex-column justify-content-center" style="height: inherit;">
            <div class="align-self-center">
                <img id="img-splash" src="Images/capaFundoEscuro.png" alt=""/>
            </div>
        </div>
    </div> -->

    <canvas></canvas>
    <!-- <div id="link">
        <a id="linkGit"  target="__blank" href="https://github.com/e-llo/beans">GitHub: https://github.com/e-llo/beans </a>
    </div> -->
    <div class="cronometro">
        <span id="hora">00</span>:<span id="minuto">00</span>:<span id="segundo">00</span>:<span id="milisegundo">00</span>
    </div>

    <!-- <div class="framerate">
        <p>Frame rate: <span id="framerate"></span></p>
    </div> -->

    <!-- Hierarquia tabs
        tab-info > tab-title ou tab-body
    -->
    
    <div id="tabs">
        <div id="tabs-botoes" class="position-absolute d-flex" style="top:0; right:0;">
            <button type="button" class="btn btn-dark" onclick="$('#tab-simulacao').show();">Simulação</button>
        </div>

        <div id="tabs-conteudos">
            <!--------------------- TAB SIMULACAO ---------------------->
            <div id="tab-simulacao" class="tab-info w-300px" style="right: 5px; top:calc(50% - 215px);">
                <div class="tab-title">
                    Simulação
                    <button type="button" class="btn close-btn" onclick=" $(this).closest('.tab-info').hide()">
                        <i class="fal fa-minus"></i>
                    </button>
                </div>
                <div class="tab-body">

                    <div id="painelInicial">
                        <div id="initial_inputs" class="p-0 m-0">
                            <label id="organism" name="organism" for="slider_input_organisms">Carnívoros: <label id="output_organisms">35</label></label>
                            <input type="range" min="0" max="500" value="4" class="slider-red" step="1" id="slider_input_organisms" oninput="output_organisms.textContent=slider_input_organisms.value">
                            <label id="vegetable" name="vegetable" for="slider_input_vegetables">Vegetais: <label id="output_vegetables">800</label></label>
                            <input type="range" min="0" max="3000" value="100" class="slider-yellow" step="5" id="slider_input_vegetables" oninput="output_vegetables.textContent=slider_input_vegetables.value">    
                        </div>
                        <label id="taxavegetable" name="taxavegetable" for="input_vegetable_rate">Aparição de vegetais: <label id="num_vegetable_rate">100</label> por segundo</label>
                        <input type="range" min="0" max="1000" value="10" class="slider-yellow" step="1" id="input_vegetable_rate" oninput="change_vegetable_rate()"
                            onchange="update_vegetables_apparition_interval(input_vegetable_rate.value)">


                        <label id="probMutacao" name="probMutacao" for="input_mutation_probability">Probabilidade de mutação: <label id="num_mutation_probability">10</label>%</label>
                        <input type="range" min="0" max="100" value="10" class="slider-blue" id="input_mutation_probability" oninput="change_mutation_probability()"
                            onchange="update_mutation_probability(input_mutation_probability.value)">

                    
                        <label id="magMutacao" name="magMutacao" for="input_mutation_magnitude">Magnitude das mutações: <label id="num_mutation_magnitude">5</label>%</label>
                        <input type="range" min="0" max="100" value="5" class="slider-blue" id="input_mutation_magnitude" oninput="change_mutation_magnitude()"
                            onchange="update_mutation_magnitude(input_mutation_magnitude.value)">


                        <div id="initial_buttons" class ="row mt-3">
                            <div class="col-sm-3 d-grid gap-2">
                                <button type="button" class="btn btn-sm btn-outline-secondary" style="color: #ddd" onclick="set_default_config()">Default</button>
                            </div>
                            <div class="col-sm-9 d-grid gap-2">
                                <button type="button" class="btn btn-sm btn-success" onclick="startSimulation()">Play</button>
                            </div>
                        </div>
                        <div id="extra_buttons" class="mt-3 text-center d-none">
                            <button id="restartBtn" type="button" class="btn btn-sm btn-block btn-outline-secondary" style="color: #ddd" onclick="show_initial_panel()">Restart</button>
                            <div id="btnDesacelera" class="" onclick="desacelera()" style="cursor: pointer; display: inline; margin-left: 10px;">
                                <i class="fas fa-arrow-alt-to-left"></i>
                            </div>
                            <div id="button_pause_simulation" class="" onclick="pausa()" style="cursor: pointer; display: inline; margin-left: 10px;">
                                <i class="fas fa-pause"></i>
                            </div>
                            <div id="button_resume_simulation" class="d-none" onclick="despausa()" style="cursor: pointer; display: inline; margin-left: 10px;">
                                <i class="fas fa-play"></i>
                            </div>
                            <div id="btnAcelera" class="" onclick="acelera()" style="cursor: pointer; display: inline; margin-left: 10px;">
                                <i class="fas fa-angle-double-right"></i>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
            <!--------------------- FIM TAB SIMULACAO ------------------>

        </div>
    </div>

    <!-- TOAST -->
    <!-- <div class="position-absolute" style="top: 40%; right: 350px;" >
        <div role="alert" aria-live="assertive" aria-atomic="true" class="toast align-items-center text-white bg-secondary border-0" data-autohide="false" >
            <div class="d-flex">
                <div class="toast-body">
                    Informe os parâmetros de entrada e clique em Play para iniciar a simulação. Clique em Default para restaurar as configurações padrão.<br/>
                    <b>Você também pode dar zoom in/out com a roda do mouse, além de usá-la para se mover pela tela clicando e arrastando!</b>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>    
    </div> -->
    
    
  <script type="text/javascript">
        var input_vegetable_rate = document.getElementById("input_vegetable_rate");
        const label_vegetable_rate = document.getElementById("num_vegetable_rate");

        var input_mutation_probability = document.getElementById("input_mutation_probability");
        const label_mutation_probability = document.getElementById("num_mutation_probability");

        var input_mutation_magnitude = document.getElementById("input_mutation_magnitude");
        const label_mutation_magnitude = document.getElementById("num_mutation_magnitude");

        var n_organisms;
        var n_vegetables;

        var is_before_play = true;

        var is_running = false;  

        // Variável para pausar e despausar o jogo
        var is_paused = false;

        // Variáveis para auxiliar a atualizar os valores dos sliders
        var slider_input_organisms = document.getElementById("slider_input_organisms");
        var output_organisms = document.getElementById("output_organisms");
        output_organisms.innerHTML = slider_input_organisms.value;

        var slider_input_vegetables = document.getElementById("slider_input_vegetables");
        var output_vegetables = document.getElementById("output_vegetables");
        output_vegetables.innerHTML = slider_input_vegetables.value;

        // Variáveis para pausar e despausar a simulação
        var button_pause_simulation = document.getElementById("button_pause_simulation");
        var button_resume_simulation = document.getElementById("button_resume_simulation");


        // Update do valor do slider a cada vez que ele é modificado
        slider_input_organisms.oninput = function(){
            output_organisms.innerHTML = this.value;
            n_organisms = output_organisms.innerHTML;
        }

        slider_input_vegetables.oninput = function(){
            output_vegetables.innerHTML = this.value;
            n_vegetables = output_vegetables.innerHTML;
        }

        $(document).ready(function(){
            document.querySelectorAll(".tab-info").forEach(element => drag_screen_element(element))
        });


        function startSimulation(){ 
            universe_size = 1; 
            n_organisms = parseInt(document.getElementById("output_organisms").textContent) * universe_size;
            n_vegetables = parseInt(document.getElementById("output_vegetables").textContent) * universe_size;
            

            is_before_play = false;
            destroy_objects();
            reset_timer();
            history.clear(); //julia:checar se está sendo utilizado
            create_timer();
            create_universe(universe_size);
            create_objects(n_organisms, n_vegetables);
                        

            input_vegetable_rate = document.getElementById("input_vegetable_rate");
            update_vegetables_apparition_interval(input_vegetable_rate.value, true);
            input_mutation_probability = document.getElementById("input_mutation_probability");
            update_mutation_probability(input_mutation_probability.value);
            input_mutation_magnitude = document.getElementById("input_mutation_magnitude");
            update_mutation_magnitude(input_mutation_magnitude.value);
            // document.getElementById("initial_inputs").classList.add("d-none");
            // document.getElementById("divTamanhoUniverso").classList.add("d-none");
            // document.getElementById("extra_panel").classList.remove("d-none");
            // document.getElementById("initial_buttons").classList.add("d-none");
            // document.getElementById("extra_buttons").classList.remove("d-none");
            // document.getElementById("baixar-dados").classList.remove("d-none"); // FIND DADOS
            if(!is_running && !is_paused) { 
                animate(); 
            }
            is_running = true;
        }
       
        function set_default_config(){// volta os parâmetros para o padrão inicial
            document.getElementById("output_organisms").textContent = 35;
            document.getElementById("slider_input_organisms").value = 35;


            document.getElementById("output_vegetables").textContent = 800;
            document.getElementById("slider_input_vegetables").value = 800;

            document.getElementById("num_mutation_probability").textContent = 10;
            document.getElementById("num_mutation_magnitude").textContent = 5;

            label_vegetable_rate.textContent = 100;
            input_vegetable_rate.value = 100;
            input_mutation_probability.value = 10;
            input_mutation_magnitude.value = 5;
        }
        

        function show_initial_panel() {
            destroy_objects();
            reset_timer();
            is_before_play = true;
            input_vegetable_rate = document.getElementById("input_vegetable_rate");
            update_vegetables_apparition_interval(input_vegetable_rate.value);
            input_mutation_probability = document.getElementById("input_mutation_probability");
            update_mutation_probability(input_mutation_probability.value);
            input_mutation_magnitude = document.getElementById("input_mutation_magnitude");
            update_mutation_magnitude(input_mutation_magnitude.value);
            document.getElementById("initial_inputs").classList.remove("d-none");
            document.getElementById("initial_buttons").classList.remove("d-none");
            document.getElementById("extra_buttons").classList.add("d-none");
            document.getElementById("extra_panel").classList.add("d-none");
        }


        function change_mutation_probability(){
            label_mutation_probability.textContent = input_mutation_probability.value;
        }

        function change_mutation_magnitude(){
            label_mutation_magnitude.textContent = input_mutation_magnitude.value;
        }

        function change_vegetable_rate() {
            if(input_vegetable_rate.value > 0) {
                label_vegetable_rate.textContent = input_vegetable_rate.value;
            } else {
                label_vegetable_rate.textContent = "nenhum";
            }
        }

        function drag_screen_element(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

            // se for uma tab
            if (element.classList.contains("tab-info")) {
                // inserir o evento de arrastar na div de titulo (primeiro filho dentro da tab)
                element.children[0].onmousedown = drag_mouse_down;
            } else {
                // otherwise, move the DIV from anywhere inside the DIV:
                element.onmousedown = drag_mouse_down;
            }

            function drag_mouse_down(e) {
                    e = e || window.event;
                    e.preventDefault();
                    // get the mouse cursor position at startup:
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    document.onmouseup = close_drag_element;
                    // call a function whenever the cursor moves:
                    document.onmousemove = element_drag;
                }

            function element_drag(e) {
                    e = e || window.event;
                    e.preventDefault();
                    // calculate the new cursor position:
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    // set the element's new position:
                    element.style.top = (element.offsetTop - pos2) + "px";
                    element.style.left = (element.offsetLeft - pos1) + "px";
                }

            function close_drag_element() {
                    // stop moving when mouse button is released:
                    document.onmouseup = null;
                    document.onmousemove = null;
                }
            }

    </script>
    <script type="text/javascript" src="./src/index.js"></script>
    <script type="text/javascript" src="./src/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js" integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT" crossorigin="anonymous"></script>

</body>
</html>